asyncapi: 3.0.0
info:
  title: Amazon Microservice API
  version: 1.0.0
  description: |
    This microservice provides endpoints for searching Amazon listings.
    It handles product searches and returns listing data from Amazon platform.

servers:
  production:
    host: localhost:3022
    protocol: http
    description: Amazon Microservice Production Server

channels:
  http/amazon:
    address: '/amazon'
    messages:
      searchListings:
        $ref: '#/components/messages/searchListings'
      listingResults:
        $ref: '#/components/messages/listingResults'

operations:
  searchAmazonListings:
    action: receive
    channel:
      $ref: '#/channels/http~1amazon'
    summary: Search Amazon listings
    description: Searches for products on Amazon platform based on query parameters
    messages:
      - $ref: '#/channels/http~1amazon/messages/searchListings'

components:
  messages:
    searchListings:
      name: SearchListings
      title: Search Amazon listings
      summary: Request to search Amazon listings
      contentType: application/json
      payload:
        $ref: '#/components/schemas/SearchRequest'

    listingResults:
      name: ListingResults
      title: Amazon listing results
      summary: Results from Amazon search
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ListingResults'

  schemas:
    SearchRequest:
      type: object
      properties:
        query:
          type: string
          description: Search query
          example: "smartphone"
        limit:
          type: integer
          description: Maximum number of results
          default: 20
          minimum: 1
          maximum: 100
        offset:
          type: integer
          description: Number of results to skip
          default: 0
          minimum: 0
        country:
          type: string
          description: Amazon country domain
          default: "PL"
          example: "PL"
        page:
          type: integer
          description: Page number
          default: 1
          minimum: 1
      required:
        - query

    ListingResults:
      type: array
      items:
        $ref: '#/components/schemas/Listing'

    Listing:
      type: object
      properties:
        title:
          type: string
          description: Product title
        url:
          type: string
          description: Product URL
        price:
          type: string
          description: Product price
        image:
          type: string
          description: Product image URL
        description:
          type: string
          description: Product description
        location:
          type: string
          description: Product location