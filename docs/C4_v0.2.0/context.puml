@startuml C4_Context_MVP
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

Person(user, "User", "Person searching for a gift")

System(system_rest_api, "REST API Macroservice", "Main entry point providing HTTP REST API, authentication, and SSE for real-time updates")
System(system_gift_microservice, "Gift Ideas Microservice", "Orchestrates gift recommendations based on keywords and user preferences")
System(system_stalking_microservice, "Stalking Microservice", "Scrapes and analyzes social media profiles to extract interests and keywords")
System(system_chat_microservice, "Chat Microservice", "Conducts AI-driven interviews to gather additional context when needed")
System(system_fetch_microservice, "Fetch Microservice", "Fetches product listings from multiple e-commerce providers")
System(system_reranking_microservice, "Reranking Microservice", "Reranks and filters products based on user preferences and context")

System_Ext(allegro, "Allegro", "Polish e-commerce platform")
System_Ext(amazon, "Amazon", "Global e-commerce platform")
System_Ext(ebay, "eBay", "Online marketplace")
System_Ext(olx, "OLX", "Classified advertisements platform")

System_Ext(openai_llm, "OpenAI", "LLM for analysis and gift idea generation")
System_Ext(google_gemini_llm, "Google Gemini", "LLM for chat interviews and product scoring")
System_Ext(brightdata, "BrightData", "Web scraping proxy service for social media data collection")
System_Ext(google_oauth, "Google OAuth", "Authentication provider for user login")
System_Ext(instagram_ext, "Instagram", "Social media platform")
System_Ext(tiktok_ext, "TikTok", "Social media platform")
System_Ext(x_ext, "X (Twitter)", "Social media platform")

Rel(user, system_rest_api, "Authenticates & provides social links & preferences", "HTTPS/SSE")
Rel(system_rest_api, google_oauth, "Validates OAuth tokens", "HTTPS")
Rel(google_oauth, system_rest_api, "Returns user info", "HTTPS")
Rel(system_rest_api, system_stalking_microservice, "Initiates stalking analysis", "RabbitMQ")
Rel(system_rest_api, system_chat_microservice, "Initiates interview", "RabbitMQ")
Rel(system_rest_api, user, "Sends real-time updates", "SSE")

Rel(system_stalking_microservice, brightdata, "Requests scraping", "HTTPS")
Rel(brightdata, instagram_ext, "Scrapes", "HTTPS")
Rel(brightdata, tiktok_ext, "Scrapes", "HTTPS")
Rel(brightdata, x_ext, "Scrapes", "HTTPS")
Rel(system_stalking_microservice, openai_llm, "Analyzes content for keywords", "HTTPS")
Rel(system_stalking_microservice, system_gift_microservice, "Sends keywords", "RabbitMQ")

Rel(system_chat_microservice, google_gemini_llm, "Generates interview questions", "HTTPS")
Rel(system_chat_microservice, system_rest_api, "Sends questions to user", "RabbitMQ")
Rel(system_chat_microservice, system_gift_microservice, "Sends interview results", "RabbitMQ")

Rel(system_gift_microservice, openai_llm, "Generates gift ideas", "HTTPS")
Rel(system_gift_microservice, system_fetch_microservice, "Requests product listings", "RabbitMQ")

Rel(system_fetch_microservice, allegro, "Fetches products", "HTTPS/API")
Rel(system_fetch_microservice, amazon, "Fetches products", "HTTPS/API")
Rel(system_fetch_microservice, ebay, "Fetches products", "HTTPS/API")
Rel(system_fetch_microservice, olx, "Fetches products", "HTTPS/API")
Rel(system_fetch_microservice, system_reranking_microservice, "Sends fetched products", "RabbitMQ")
Rel(system_reranking_microservice, google_gemini_llm, "Scores products for relevance", "HTTPS")

Rel(system_reranking_microservice, system_rest_api, "Sends final gift recommendations", "RabbitMQ")

SHOW_LEGEND()
@enduml
