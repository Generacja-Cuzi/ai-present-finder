<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="1503px" preserveAspectRatio="none" style="width:2296px;height:1503px;background:#FFFFFF;" version="1.1" viewBox="0 0 2296 1503" width="2296px" zoomAndPan="magnify"><defs/><g><!--cluster reranking--><g class="cluster" data-entity="reranking" data-source-line="1660" data-uid="ent0002" id="cluster_reranking"><rect fill="none" height="1217.28" style="stroke:#444444;stroke-width:1;stroke-dasharray:7,7;" width="1847" x="224.73" y="168.95"/><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="263.4531" x="1016.5034" y="186.4188">Reranking Microservice (NestJS)</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="67.0137" x="1114.7232" y="201.3953">[container]</text></g><!--entity context_handler--><g class="entity" data-entity="context_handler" data-source-line="68" data-uid="ent0003" id="entity_context_handler"><rect fill="#85BBF0" height="135.418" style="stroke:#78A8D8;stroke-width:0.5;" width="260.9688" x="240.24" y="475.86"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="240.9688" x="250.24" y="501.3288">GiftContextInitializedHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="35.2383" x="326.5007" y="516.3053">[Event</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="361.739" y="516.3053">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="365.5359" y="516.3053">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="368.5095" y="532.3717">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.8066" x="335.3211" y="548.86">Consumes</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.8828" x="277.783" y="565.3483">GiftContextInitializedEvent,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.0918" x="329.0457" y="581.8366">delegates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="394.1375" y="581.8366">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.8359" x="398.5671" y="581.8366">to</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.7412" x="267.8538" y="598.3248">InitializeGiftContextCommand</text></g><!--entity product_handler--><g class="entity" data-entity="product_handler" data-source-line="68" data-uid="ent0004" id="entity_product_handler"><rect fill="#85BBF0" height="151.9063" style="stroke:#78A8D8;stroke-width:0.5;" width="212.3125" x="863.57" y="219.95"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="192.3125" x="873.57" y="245.4188">ProductFetchedHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="35.2383" x="925.5026" y="260.3953">[Event</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="960.7409" y="260.3953">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="964.5378" y="260.3953">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="967.5114" y="276.4617">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.8066" x="934.3229" y="292.95">Consumes</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.9746" x="896.7389" y="309.4383">ProductFetchedEvent,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.9932" x="900.2424" y="325.9266">orchestrates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="984.2355" y="325.9266">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5449" x="988.6652" y="325.9266">session</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.4316" x="881.3615" y="342.4148">creation,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="940.7931" y="342.4148">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.0469" x="945.2228" y="342.4148">product</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="998.2697" y="342.4148">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.3916" x="1002.6994" y="342.4148">storage,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="886.8884" y="358.9031">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="912.1198" y="358.9031">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.0703" x="916.5495" y="358.9031">completion</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="992.6198" y="358.9031">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.5146" x="997.0495" y="358.9031">tracking</text></g><!--entity create_session--><g class="entity" data-entity="create_session" data-source-line="68" data-uid="ent0005" id="entity_create_session"><rect fill="#85BBF0" height="102.4414" style="stroke:#78A8D8;stroke-width:0.5;" width="202.2598" x="460.6" y="649.52"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="180.7031" x="471.3783" y="674.9888">CreateSessionHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="503.3207" y="689.9653">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="566.9301" y="689.9653">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="570.727" y="689.9653">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="559.515" y="706.0317">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.1191" x="470.6" y="722.52">Creates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="521.7191" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14.3281" x="526.1488" y="722.52">or</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="540.477" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52.9785" x="544.9066" y="722.52">ensures</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="597.8852" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5449" x="602.3148" y="722.52">session</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.9424" x="502.7836" y="739.0083">exists</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="542.726" y="739.0083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4756" x="547.1557" y="739.0083">for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="566.6313" y="739.0083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.6152" x="571.0609" y="739.0083">eventId</text></g><!--entity init_context--><g class="entity" data-entity="init_context" data-source-line="68" data-uid="ent0006" id="entity_init_context"><rect fill="#85BBF0" height="118.9297" style="stroke:#78A8D8;stroke-width:0.5;" width="250.3672" x="240.54" y="798.45"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="230.3672" x="250.54" y="823.9188">InitializeGiftContextHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="307.3144" y="838.8953">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="370.9238" y="838.8953">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="374.7207" y="838.8953">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="363.5087" y="854.9617">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.8389" x="280.8076" y="871.45">Initializes</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="345.6464" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14.3281" x="350.0761" y="871.45">or</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="364.4043" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.2158" x="368.8339" y="871.45">updates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="423.0498" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="23.1602" x="427.4795" y="871.45">gift</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.3174" x="267.4433" y="887.9383">context</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="318.7607" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28.7588" x="323.1904" y="887.9383">with</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="351.9492" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29.3535" x="356.3789" y="887.9383">user</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="385.7324" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.1807" x="390.1621" y="887.9383">profile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="434.3427" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="438.7724" y="887.9383">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.3604" x="333.5434" y="904.4266">keywords</text></g><!--entity add_products--><g class="entity" data-entity="add_products" data-source-line="68" data-uid="ent0007" id="entity_add_products"><rect fill="#85BBF0" height="102.4414" style="stroke:#78A8D8;stroke-width:0.5;" width="274.0938" x="1002.68" y="649.52"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="254.0938" x="1012.68" y="674.9888">AddProductsToSessionHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="1081.3177" y="689.9653">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1144.9271" y="689.9653">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="1148.7239" y="689.9653">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1137.512" y="706.0317">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.041" x="1050.3299" y="722.52">Stores</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1092.3709" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.1836" x="1096.8006" y="722.52">products</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1156.9842" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="12.7354" x="1161.4139" y="722.52">in</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1174.1492" y="722.52">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5449" x="1178.5789" y="722.52">session</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28.7588" x="1046.0814" y="739.0083">with</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1074.8402" y="739.0083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.124" x="1079.2698" y="739.0083">source</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1124.3939" y="739.0083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.7705" x="1128.8236" y="739.0083">event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1165.5941" y="739.0083">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.3486" x="1170.0237" y="739.0083">metadata</text></g><!--entity increment_completion--><g class="entity" data-entity="increment_completion" data-source-line="68" data-uid="ent0008" id="entity_increment_completion"><rect fill="#85BBF0" height="118.9297" style="stroke:#78A8D8;stroke-width:0.5;" width="324.9766" x="670.24" y="641.28"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="304.9766" x="680.24" y="666.7488">IncrementSessionCompletionHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="774.3191" y="681.7253">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="837.9285" y="681.7253">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="841.7254" y="681.7253">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="830.5134" y="697.7917">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.3525" x="732.9954" y="714.28">Increments</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="808.3479" y="714.28">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.3467" x="812.7776" y="714.28">completed</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="884.1243" y="714.28">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.9072" x="888.554" y="714.28">events</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.3418" x="744.2815" y="730.7683">counter,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="800.6233" y="730.7683">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.8496" x="805.053" y="730.7683">marks</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="846.9026" y="730.7683">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5449" x="851.3323" y="730.7683">session</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="901.8772" y="730.7683">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14.8682" x="906.3069" y="730.7683">as</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.5352" x="762.0994" y="747.2566">complete</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="824.6345" y="747.2566">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.9639" x="829.0642" y="747.2566">when</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="865.0281" y="747.2566">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33.8994" x="869.4578" y="747.2566">done</text></g><!--entity emit_ready--><g class="entity" data-entity="emit_ready" data-source-line="68" data-uid="ent0009" id="entity_emit_ready"><rect fill="#85BBF0" height="118.9297" style="stroke:#78A8D8;stroke-width:0.5;" width="292.2813" x="1520.59" y="484.11"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="272.2813" x="1530.59" y="509.5788">RerankAndEmitGiftReadyHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="1608.3214" y="524.5553">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1671.9308" y="524.5553">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="1675.7277" y="524.5553">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1664.5158" y="540.6217">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.6465" x="1577.3849" y="557.11">Retrieves</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1639.0314" y="557.11">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.6133" x="1643.4611" y="557.11">products,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1708.0744" y="557.11">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.5723" x="1712.5041" y="557.11">scores</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34.7949" x="1568.4914" y="573.5983">them</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1603.2863" y="573.5983">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.0244" x="1607.716" y="573.5983">via</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1626.7404" y="573.5983">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="18.1221" x="1631.1701" y="573.5983">AI,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1649.2921" y="573.5983">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.1426" x="1653.7218" y="573.5983">filters</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1692.8644" y="573.5983">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.9883" x="1697.2941" y="573.5983">(score</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1738.2824" y="573.5983">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.2578" x="1742.7121" y="573.5983">&gt;=</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17.835" x="1569.0998" y="590.0866">5),</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1586.9347" y="590.0866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="1591.3644" y="590.0866">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1616.5959" y="590.0866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.29" x="1621.0255" y="590.0866">emits</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1658.3156" y="590.0866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6162" x="1662.7453" y="590.0866">GiftReadyEvent</text></g><!--entity mark_timeout--><g class="entity" data-entity="mark_timeout" data-source-line="68" data-uid="ent0010" id="entity_mark_timeout"><rect fill="#85BBF0" height="118.9297" style="stroke:#78A8D8;stroke-width:0.5;" width="266.1094" x="807.67" y="798.45"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="246.1094" x="817.67" y="823.9188">MarkTimeoutSessionsHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="882.3155" y="838.8953">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="945.9249" y="838.8953">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="949.7218" y="838.8953">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="938.5098" y="854.9617">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.8379" x="851.4029" y="871.45">Marks</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="892.2408" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.9668" x="896.6705" y="871.45">inactive</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="948.6373" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.6816" x="953.067" y="871.45">sessions</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1010.7486" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14.8682" x="1015.1783" y="871.45">as</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9648" x="874.546" y="887.9383">timed</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="913.5108" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.5244" x="917.9405" y="887.9383">out</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="940.4649" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.291" x="944.8946" y="887.9383">based</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="985.1856" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17.2881" x="989.6153" y="887.9383">on</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.084" x="871.1827" y="904.4266">EVENT_TIMEOUT_MS</text></g><!--entity get_session_products--><g class="entity" data-entity="get_session_products" data-source-line="68" data-uid="ent0011" id="entity_get_session_products"><rect fill="#85BBF0" height="135.418" style="stroke:#78A8D8;stroke-width:0.5;" width="247.6406" x="1249.91" y="790.21"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="227.6406" x="1259.91" y="815.6788">GetSessionProductsHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38.5371" x="1327.8573" y="830.6553">[Query</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1366.3944" y="830.6553">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="1370.1913" y="830.6553">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1371.5155" y="846.7217">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.5029" x="1346.4788" y="863.21">Handles</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.0488" x="1284.7059" y="879.6983">GetSessionProductsQuery,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58.5225" x="1292.0238" y="896.1866">retrieves</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1350.5462" y="896.1866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5449" x="1354.9759" y="896.1866">session</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1405.5208" y="896.1866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="1409.9505" y="896.1866">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1435.182" y="896.1866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="15.8252" x="1439.6117" y="896.1866">all</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.1836" x="1343.6385" y="912.6748">products</text></g><!--entity score_products--><g class="entity" data-entity="score_products" data-source-line="68" data-uid="ent0012" id="entity_score_products"><rect fill="#85BBF0" height="118.9297" style="stroke:#78A8D8;stroke-width:0.5;" width="219.7188" x="1835.87" y="798.45"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="181.8359" x="1854.8114" y="823.9188">ScoreProductsHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38.5371" x="1899.8563" y="838.8953">[Query</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1938.3934" y="838.8953">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="1942.1903" y="838.8953">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1943.5145" y="854.9617">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.5029" x="1845.87" y="871.45">Handles</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1900.3729" y="871.45">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.7861" x="1904.8026" y="871.45">ScoreProductsQuery,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52.5752" x="1852.8085" y="887.9383">batches</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1905.3837" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.6133" x="1909.8134" y="887.9383">products,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1974.4266" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="1978.8563" y="887.9383">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2004.0878" y="887.9383">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.1328" x="2008.5175" y="887.9383">calls</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.4854" x="1882.4867" y="904.4266">scoreProductsFlow</text></g><!--entity update_ratings--><g class="entity" data-entity="update_ratings" data-source-line="68" data-uid="ent0013" id="entity_update_ratings"><rect fill="#85BBF0" height="135.418" style="stroke:#78A8D8;stroke-width:0.5;" width="268.7578" x="1532.35" y="790.21"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="248.7578" x="1542.35" y="815.6788">UpdateProductRatingsHandler</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.6094" x="1608.3197" y="830.6553">[Command</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1671.9291" y="830.6553">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49.4121" x="1675.726" y="830.6553">Handler]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1664.5141" y="846.7217">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.5029" x="1639.4774" y="863.21">Handles</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224.5742" x="1554.4418" y="879.6983">UpdateProductRatingsCommand,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.2158" x="1590.7201" y="896.1866">updates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1644.9359" y="896.1866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.1836" x="1649.3656" y="896.1866">products</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1709.5492" y="896.1866">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28.7588" x="1713.9789" y="896.1866">with</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.5723" x="1594.3227" y="912.6748">scores</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1637.8949" y="912.6748">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="1642.3246" y="912.6748">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1667.5561" y="912.6748">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.1494" x="1671.9857" y="912.6748">reasoning</text></g><!--entity ranking_service--><g class="entity" data-entity="ranking_service" data-source-line="68" data-uid="ent0014" id="entity_ranking_service"><rect fill="#85BBF0" height="151.9063" style="stroke:#78A8D8;stroke-width:0.5;" width="199.2588" x="1839.1" y="1029.63"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="155.3047" x="1861.0771" y="1055.0988">scoreProductsFlow</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="15.6387" x="1906.7753" y="1070.0753">[AI</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1922.414" y="1070.0753">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="44.4727" x="1926.2108" y="1070.0753">Service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1936.5146" y="1086.1417">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.7734" x="1870.5819" y="1102.63">Uses</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1902.3554" y="1102.63">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.8926" x="1906.7851" y="1102.63">Google</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1954.6776" y="1102.63">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.7695" x="1959.1073" y="1102.63">Gemini</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155.8047" x="1849.1" y="1119.1183">(gemini-2.5-flash-lite)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2004.9047" y="1119.1183">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.0244" x="2009.3344" y="1119.1183">via</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.0098" x="1854.8524" y="1135.6066">ai-sdk</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1898.8622" y="1135.6066">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.8359" x="1903.2919" y="1135.6066">to</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1917.1278" y="1135.6066">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.4355" x="1921.5575" y="1135.6066">score</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1957.9931" y="1135.6066">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.1836" x="1962.4228" y="1135.6066">products</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.291" x="1851.6977" y="1152.0948">based</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1891.9887" y="1152.0948">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17.2881" x="1896.4184" y="1152.0948">on</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1913.7064" y="1152.0948">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29.3535" x="1918.1361" y="1152.0948">user</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1947.4896" y="1152.0948">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.1807" x="1951.9193" y="1152.0948">profile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1996.1" y="1152.0948">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.2314" x="2000.5297" y="1152.0948">and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.3604" x="1906.5492" y="1168.5831">keywords</text></g><!--entity gift_session_repo--><g class="entity" data-entity="gift_session_repo" data-source-line="68" data-uid="ent0015" id="entity_gift_session_repo"><rect fill="#85BBF0" height="102.4414" style="stroke:#78A8D8;stroke-width:0.5;" width="201.5781" x="660.94" y="1054.36"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="181.5781" x="670.94" y="1079.8288">GiftSessionRepository</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59.2441" x="697.3463" y="1094.8053">[TypeORM</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="756.5904" y="1094.8053">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="65.7246" x="760.3873" y="1094.8053">Repository]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="759.5142" y="1110.8717">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.126" x="673.7505" y="1127.36">Repository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="745.8765" y="1127.36">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4756" x="750.3062" y="1127.36">for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="769.7818" y="1127.36">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.4961" x="774.2115" y="1127.36">GiftSession</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3223" x="742.5679" y="1143.8483">entity</text></g><!--entity gift_session_product_repo--><g class="entity" data-entity="gift_session_product_repo" data-source-line="68" data-uid="ent0016" id="entity_gift_session_product_repo"><rect fill="#85BBF0" height="102.4414" style="stroke:#78A8D8;stroke-width:0.5;" width="264.9922" x="1107.23" y="1054.36"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="244.9922" x="1117.23" y="1079.8288">GiftSessionProductRepository</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59.2441" x="1175.3433" y="1094.8053">[TypeORM</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1234.5874" y="1094.8053">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="65.7246" x="1238.3843" y="1094.8053">Repository]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1237.5113" y="1110.8717">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.126" x="1191.7105" y="1127.36">Repository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1263.8364" y="1127.36">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4756" x="1268.2661" y="1127.36">for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4697" x="1154.6153" y="1143.8483">GiftSessionProduct</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1282.085" y="1143.8483">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3223" x="1286.5147" y="1143.8483">entity</text></g><!--entity product_repo--><g class="entity" data-entity="product_repo" data-source-line="68" data-uid="ent0017" id="entity_product_repo"><rect fill="#85BBF0" height="85.9531" style="stroke:#78A8D8;stroke-width:0.5;" width="215.1865" x="1445.13" y="1062.6"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="152.2031" x="1476.6217" y="1088.0688">ProductRepository</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59.2441" x="1488.3404" y="1103.0453">[TypeORM</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1547.5846" y="1103.0453">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="65.7246" x="1551.3815" y="1103.0453">Repository]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1550.5084" y="1119.1117">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.126" x="1455.13" y="1135.6">Repository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1527.256" y="1135.6">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4756" x="1531.6857" y="1135.6">for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1551.1613" y="1135.6">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.9736" x="1555.5909" y="1135.6">Product</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1607.5646" y="1135.6">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3223" x="1611.9943" y="1135.6">entity</text></g><!--entity database--><g class="entity" data-entity="database" data-source-line="72" data-uid="ent0018" id="entity_database"><path d="M1138.03,1285.28 C1138.03,1275.28 1239.7307,1275.28 1239.7307,1275.28 C1239.7307,1275.28 1341.4314,1275.28 1341.4314,1285.28 L1341.4314,1360.2331 C1341.4314,1370.2331 1239.7307,1370.2331 1239.7307,1370.2331 C1239.7307,1370.2331 1138.03,1370.2331 1138.03,1360.2331 L1138.03,1285.28" fill="#85BBF0" style="stroke:#78A8D8;stroke-width:0.5;"/><path d="M1138.03,1285.28 C1138.03,1295.28 1239.7307,1295.28 1239.7307,1295.28 C1239.7307,1295.28 1341.4314,1295.28 1341.4314,1285.28" fill="none" style="stroke:#78A8D8;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="94.3906" x="1192.5354" y="1314.7488">PostgreSQL</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="61.5176" x="1208.9719" y="1329.7253">[Database]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1237.5158" y="1345.7917">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64.5654" x="1148.03" y="1362.28">TypeORM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1212.5954" y="1362.28">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.3555" x="1217.0251" y="1362.28">persistence</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1294.3806" y="1362.28">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.6211" x="1298.8103" y="1362.28">layer</text></g><!--entity rabbitmq_in_context--><g class="entity" data-entity="rabbitmq_in_context" data-source-line="80" data-uid="ent0019" id="entity_rabbitmq_in_context"><rect fill="#CCCCCC" height="102.4414" style="stroke:#BFBFBF;stroke-width:0.5;" width="201.4531" x="7" y="244.69"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="81.0391" x="67.207" y="270.1588">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53.9531" x="58.0039" y="285.1353">[Message</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="111.957" y="285.1353">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="41.6953" x="115.7539" y="285.1353">Broker]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="105.5117" y="301.2017">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.4531" x="17" y="317.69">GiftContextInitializedEvent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.7881" x="86.8325" y="334.1783">queue</text></g><!--entity rabbitmq_in_product--><g class="entity" data-entity="rabbitmq_in_product" data-source-line="80" data-uid="ent0020" id="entity_rabbitmq_in_product"><rect fill="#CCCCCC" height="85.9531" style="stroke:#BFBFBF;stroke-width:0.5;" width="207.7627" x="865.85" y="7"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="81.0391" x="929.2118" y="32.4688">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53.9531" x="920.0087" y="47.4453">[Message</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="973.9618" y="47.4453">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="41.6953" x="977.7587" y="47.4453">Broker]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="967.5165" y="63.5117">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141.5449" x="875.85" y="80">ProductFetchedEvent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="1017.3949" y="80">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.7881" x="1021.8246" y="80">queue</text></g><!--entity rabbitmq_out--><g class="entity" data-entity="rabbitmq_out" data-source-line="80" data-uid="ent0021" id="entity_rabbitmq_out"><rect fill="#CCCCCC" height="85.9531" style="stroke:#BFBFBF;stroke-width:0.5;" width="167.834" x="2090.81" y="814.94"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="81.0391" x="2134.2075" y="840.4088">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53.9531" x="2125.0043" y="855.3853">[Message</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="2178.9575" y="855.3853">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="41.6953" x="2182.7543" y="855.3853">Broker]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2172.5121" y="871.4517">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6162" x="2100.81" y="887.94">GiftReadyEvent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2202.4262" y="887.94">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.7881" x="2206.8559" y="887.94">queue</text></g><!--entity google_gemini--><g class="entity" data-entity="google_gemini" data-source-line="80" data-uid="ent0022" id="entity_google_gemini"><rect fill="#CCCCCC" height="102.4414" style="stroke:#BFBFBF;stroke-width:0.5;" width="166.6992" x="2087.38" y="1271.53"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="57.5" x="2110.4757" y="1296.9988">Google</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="5.2734" x="2167.9757" y="1296.9988">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="57.7344" x="2173.2491" y="1296.9988">Gemini</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="30.9375" x="2155.2609" y="1311.9753">[LLM]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2168.5148" y="1328.0417">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.9736" x="2105.7506" y="1344.53">Product</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2157.7242" y="1344.53">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.1006" x="2162.1539" y="1344.53">scoring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2212.2545" y="1344.53">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.0244" x="2216.6842" y="1344.53">via</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146.6992" x="2097.38" y="1361.0183">gemini-2.5-flash-lite</text></g><!--link rabbitmq_in_context to context_handler--><g class="link" data-entity-1="rabbitmq_in_context" data-entity-2="context_handler" data-source-line="1773" data-uid="lnk23" id="link_rabbitmq_in_context_context_handler"><path d="M161.9,347.51 C201.6,384.59 250.0339,429.829 293.3039,470.249" fill="none" id="rabbitmq_in_context-to-context_handler" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="299.15,475.71,295.3518,468.0567,291.256,472.4412,299.15,475.71" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="64.2129" x="296.2175" y="421.4616">Consumes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38.4727" x="263.78" y="435.5944">[AMQP</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="302.2527" y="435.5944">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="86.8184" x="306.0495" y="435.5944">@EventPattern]</text></g><!--link context_handler to init_context--><g class="link" data-entity-1="context_handler" data-entity-2="init_context" data-source-line="1773" data-uid="lnk24" id="link_context_handler_init_context"><path d="M357.37,611.74 C355.86,621.61 354.56,631.68 353.73,641.28 C349.13,693.94 350.47,707.45 353.73,760.21 C354.48,772.45 354.8312,777.5753 356.3012,790.0153" fill="none" id="context_handler-to-init_context" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="357.24,797.96,359.2805,789.6632,353.3219,790.3673,357.24,797.96" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.2754" x="371.5816" y="698.3416">Executes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="87.9785" x="354.73" y="712.4744">[CommandBus]</text></g><!--link rabbitmq_in_product to product_handler--><g class="link" data-entity-1="rabbitmq_in_product" data-entity-2="product_handler" data-source-line="1773" data-uid="lnk25" id="link_rabbitmq_in_product_product_handler"><path d="M969.73,93.19 C969.73,127.96 969.73,170.13 969.73,211.74" fill="none" id="rabbitmq_in_product-to-product_handler" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="969.73,219.74,972.73,211.74,966.73,211.74,969.73,219.74" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="64.2129" x="1003.1675" y="135.5516">Consumes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38.4727" x="970.73" y="149.6844">[AMQP</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1009.2027" y="149.6844">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="86.8184" x="1012.9995" y="149.6844">@EventPattern]</text></g><!--link product_handler to create_session--><g class="link" data-entity-1="product_handler" data-entity-2="create_session" data-source-line="1773" data-uid="lnk26" id="link_product_handler_create_session"><path d="M863.22,336.64 C827.5,353.26 789.07,375.03 758.73,401.86 C678.14,473.12 619.8115,577.4219 588.3215,641.8819" fill="none" id="product_handler-to-create_session" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="584.81,649.07,591.0171,643.1987,585.626,640.5651,584.81,649.07" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="10.8809" x="759.73" y="421.4616">1.</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="770.6109" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="46.7695" x="774.5659" y="421.4616">Creates</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="821.3355" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="46.834" x="825.2905" y="421.4616">session</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="87.9785" x="771.938" y="435.5944">[CommandBus]</text></g><!--link product_handler to add_products--><g class="link" data-entity-1="product_handler" data-entity-2="add_products" data-source-line="1773" data-uid="lnk27" id="link_product_handler_add_products"><path d="M1019.92,372.29 C1025.59,382.05 1031.01,392.07 1035.73,401.86 C1075.94,485.4 1106.2246,580.9929 1123.6346,641.4029" fill="none" id="product_handler-to-add_products" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1125.85,649.09,1126.5173,640.5721,1120.7519,642.2336,1125.85,649.09" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="10.8809" x="1054.42" y="421.4616">2.</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1065.3009" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="31.5234" x="1069.2559" y="421.4616">Adds</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1100.7794" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.9375" x="1104.7345" y="421.4616">products</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="87.9785" x="1063.0567" y="435.5944">[CommandBus]</text></g><!--link product_handler to increment_completion--><g class="link" data-entity-1="product_handler" data-entity-2="increment_completion" data-source-line="1773" data-uid="lnk28" id="link_product_handler_increment_completion"><path d="M911.39,372.16 C905.5,381.82 900.09,391.85 895.73,401.86 C861.44,480.47 846.2401,571.1543 839.0201,632.8343" fill="none" id="product_handler-to-increment_completion" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="838.09,640.78,841.9998,633.183,836.0404,632.4855,838.09,640.78" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="10.8809" x="896.73" y="421.4616">3.</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="907.6109" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="68.9297" x="911.5659" y="421.4616">Increments</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="980.4956" y="421.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="47.1621" x="984.4507" y="421.4616">counter</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="87.9785" x="920.1821" y="435.5944">[CommandBus]</text></g><!--link product_handler to emit_ready--><g class="link" data-entity-1="product_handler" data-entity-2="emit_ready" data-source-line="1773" data-uid="lnk29" id="link_product_handler_emit_ready"><path d="M1076.34,334.49 C1195.04,376.32 1380.0549,441.5308 1512.8149,488.3208" fill="none" id="product_handler-to-emit_ready" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1520.36,490.98,1513.8121,485.4914,1511.8177,491.1502,1520.36,490.98" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="10.8809" x="1381.66" y="414.4616">4.</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1392.5409" y="414.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="34.3945" x="1396.4959" y="414.4616">Emits</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1430.8905" y="414.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="33.1465" x="1434.8455" y="414.4616">when</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1467.992" y="414.4616">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="56.4668" x="1471.9471" y="414.4616">complete</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="84.0762" x="1412.9989" y="428.5944">[CommandBus</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="76.5645" x="1416.7547" y="442.7272">(conditional)]</text></g><!--link create_session to gift_session_repo--><g class="link" data-entity-1="create_session" data-entity-2="gift_session_repo" data-source-line="1773" data-uid="lnk30" id="link_create_session_gift_session_repo"><path d="M568.65,752.33 C576.47,799.14 591.89,869.74 619.73,925.63 C643.51,973.38 676.1238,1014.4257 706.8238,1048.2557" fill="none" id="create_session-to-gift_session_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="712.2,1054.18,709.0455,1046.2397,704.6022,1050.2718,712.2,1054.18" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="640.8247" y="855.5216">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="620.73" y="869.6544">[Repository]</text></g><!--link init_context to gift_session_repo--><g class="link" data-entity-1="init_context" data-entity-2="gift_session_repo" data-source-line="1773" data-uid="lnk31" id="link_init_context_gift_session_repo"><path d="M402.8,917.55 C422.98,945.56 450.08,977.67 480.73,999.63 C534.5,1038.14 596.3929,1062.02 652.8629,1078.57" fill="none" id="init_context-to-gift_session_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="660.54,1080.82,653.7067,1075.6911,652.0192,1081.4489,660.54,1080.82" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="501.8247" y="975.2316">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="481.73" y="989.3644">[Repository]</text></g><!--link add_products to gift_session_product_repo--><g class="link" data-entity-1="add_products" data-entity-2="gift_session_product_repo" data-source-line="1773" data-uid="lnk32" id="link_add_products_gift_session_product_repo"><path d="M1131.26,752.27 C1123.26,813.22 1116.73,917.69 1148.73,999.63 C1156.49,1019.51 1164.4704,1032.1883 1178.5104,1048.1183" fill="none" id="add_products-to-gift_session_product_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1183.8,1054.12,1180.761,1046.1347,1176.2598,1050.1019,1183.8,1054.12" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="1150.3847" y="855.5216">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="1130.29" y="869.6544">[Repository]</text></g><!--link increment_completion to gift_session_repo--><g class="link" data-entity-1="increment_completion" data-entity-2="gift_session_repo" data-source-line="1773" data-uid="lnk33" id="link_increment_completion_gift_session_repo"><path d="M739.72,760.66 C731.33,769.55 724.02,779.41 718.73,790.21 C676.81,875.79 708.1238,981.8768 734.8238,1046.4668" fill="none" id="increment_completion-to-gift_session_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="737.88,1053.86,737.5963,1045.3207,732.0514,1047.6128,737.88,1053.86" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="739.8247" y="855.5216">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="719.73" y="869.6544">[Repository]</text></g><!--link mark_timeout to gift_session_repo--><g class="link" data-entity-1="mark_timeout" data-entity-2="gift_session_repo" data-source-line="1773" data-uid="lnk34" id="link_mark_timeout_gift_session_repo"><path d="M897.85,917.76 C867.55,959.35 832.0615,1008.0546 803.2115,1047.6446" fill="none" id="mark_timeout-to-gift_session_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="798.5,1054.11,805.636,1049.4114,800.787,1045.8778,798.5,1054.11" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="888.3547" y="975.2316">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="868.26" y="989.3644">[Repository]</text></g><!--link emit_ready to get_session_products--><g class="link" data-entity-1="emit_ready" data-entity-2="get_session_products" data-source-line="1773" data-uid="lnk35" id="link_emit_ready_get_session_products"><path d="M1545.16,603.49 C1528.15,614.68 1511.72,627.31 1497.73,641.28 C1455.08,683.83 1425.4378,736.7742 1404.2478,782.7642" fill="none" id="emit_ready-to-get_session_products" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1400.9,790.03,1406.9724,784.0196,1401.5231,781.5087,1400.9,790.03" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.2754" x="1551.2622" y="691.3416">Executes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="159.3398" x="1498.73" y="705.4744">GetSessionProductsQuery</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="62.9063" x="1546.9468" y="719.6072">[QueryBus]</text></g><!--link get_session_products to gift_session_repo--><g class="link" data-entity-1="get_session_products" data-entity-2="gift_session_repo" data-source-line="1773" data-uid="lnk36" id="link_get_session_products_gift_session_repo"><path d="M1249.49,914.34 C1240.46,918.21 1231.46,922 1222.73,925.63 C1099.81,976.61 964.2256,1028.6277 870.4656,1063.9777" fill="none" id="get_session_products-to-gift_session_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="862.98,1066.8,871.524,1066.7848,869.4073,1061.1706,862.98,1066.8" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="1168.9047" y="975.2316">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="1148.81" y="989.3644">[Repository]</text></g><!--link get_session_products to gift_session_product_repo--><g class="link" data-entity-1="get_session_products" data-entity-2="gift_session_product_repo" data-source-line="1773" data-uid="lnk37" id="link_get_session_products_gift_session_product_repo"><path d="M1337.11,926.05 C1315.1,966.39 1291.3813,1009.8871 1271.2013,1046.8771" fill="none" id="get_session_products-to-gift_session_product_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1267.37,1053.9,1273.8349,1048.3139,1268.5678,1045.4404,1267.37,1053.9" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="1339.8247" y="975.2316">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="1319.73" y="989.3644">[Repository]</text></g><!--link emit_ready to score_products--><g class="link" data-entity-1="emit_ready" data-entity-2="score_products" data-source-line="1773" data-uid="lnk38" id="link_emit_ready_score_products"><path d="M1813.31,592.67 C1836.88,605.52 1859.24,621.52 1876.73,641.28 C1915.54,685.14 1931.3109,743.0865 1938.7409,790.4765" fill="none" id="emit_ready-to-score_products" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1939.98,798.38,1941.7047,790.0119,1935.7771,790.9412,1939.98,798.38" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.2754" x="1967.6355" y="691.3416">Executes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="124.9863" x="1932.28" y="705.4744">ScoreProductsQuery</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="62.9063" x="1963.32" y="719.6072">[QueryBus]</text></g><!--link score_products to ranking_service--><g class="link" data-entity-1="score_products" data-entity-2="ranking_service" data-source-line="1773" data-uid="lnk39" id="link_score_products_ranking_service"><path d="M1944.05,917.76 C1943.1,951.26 1942.1173,985.5732 1941.0973,1021.4532" fill="none" id="score_products-to-ranking_service" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1940.87,1029.45,1944.0961,1021.5385,1938.0985,1021.368,1940.87,1029.45" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="40.1777" x="1952.5951" y="968.2316">Scores</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="1992.7729" y="968.2316">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.9375" x="1996.7279" y="968.2316">products</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="3.9551" x="2051.6654" y="968.2316">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="11.7832" x="2055.6205" y="968.2316">in</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="47.9531" x="1986.0229" y="982.3644">batches</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="15.6387" x="1943.85" y="996.4972">[AI</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1959.4887" y="996.4972">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="16.3066" x="1963.2855" y="996.4972">via</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="1979.5922" y="996.4972">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="92.7598" x="1983.3891" y="996.4972">generateObject]</text></g><!--link ranking_service to google_gemini--><g class="link" data-entity-1="ranking_service" data-entity-2="google_gemini" data-source-line="1773" data-uid="lnk40" id="link_ranking_service_google_gemini"><path d="M2019.87,1181.84 C2051.75,1211.41 2081.6455,1239.1287 2110.3355,1265.7487" fill="none" id="ranking_service-to-google_gemini" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="2116.2,1271.19,2112.376,1263.5495,2108.295,1267.9478,2116.2,1271.19" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="94.3711" x="2083.33" y="1224.1316">generateObject</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="44.8945" x="2108.0683" y="1238.2644">[HTTPS]</text></g><!--link emit_ready to update_ratings--><g class="link" data-entity-1="emit_ready" data-entity-2="update_ratings" data-source-line="1773" data-uid="lnk41" id="link_emit_ready_update_ratings"><path d="M1666.73,603.32 C1666.73,656.34 1666.73,726.29 1666.73,781.76" fill="none" id="emit_ready-to-update_ratings" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1666.73,789.76,1669.73,781.76,1663.73,781.76,1666.73,789.76" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="54.2754" x="1740.7437" y="691.3416">Executes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="200.3027" x="1667.73" y="705.4744">UpdateProductRatingsCommand</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="87.9785" x="1723.8921" y="719.6072">[CommandBus]</text></g><!--link update_ratings to product_repo--><g class="link" data-entity-1="update_ratings" data-entity-2="product_repo" data-source-line="1773" data-uid="lnk42" id="link_update_ratings_product_repo"><path d="M1635.58,926.05 C1615.4,969.52 1593.1184,1017.5437 1575.7384,1054.9837" fill="none" id="update_ratings-to-product_repo" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1572.37,1062.24,1578.4595,1056.2469,1573.0173,1053.7206,1572.37,1062.24" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="29.4375" x="1641.0347" y="975.2316">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69.627" x="1620.94" y="989.3644">[Repository]</text></g><!--link gift_session_repo to database--><g class="link" data-entity-1="gift_session_repo" data-entity-2="database" data-source-line="1773" data-uid="lnk43" id="link_gift_session_repo_database"><path d="M862.81,1152.08 C943.63,1188.46 1049.145,1235.9663 1130.255,1272.4763" fill="none" id="gift_session_repo-to-database" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1137.55,1275.76,1131.4864,1269.7407,1129.0236,1275.2119,1137.55,1275.76" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="48.9668" x="1065.6898" y="1224.1316">Persists</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.1465" x="1058.6" y="1238.2644">[TypeORM]</text></g><!--link gift_session_product_repo to database--><g class="link" data-entity-1="gift_session_product_repo" data-entity-2="database" data-source-line="1773" data-uid="lnk44" id="link_gift_session_product_repo_database"><path d="M1239.73,1157.03 C1239.73,1192.68 1239.73,1232.12 1239.73,1266.93" fill="none" id="gift_session_product_repo-to-database" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1239.73,1274.93,1242.73,1266.93,1236.73,1266.93,1239.73,1274.93" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="48.9668" x="1247.8198" y="1224.1316">Persists</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.1465" x="1240.73" y="1238.2644">[TypeORM]</text></g><!--link product_repo to database--><g class="link" data-entity-1="product_repo" data-entity-2="database" data-source-line="1773" data-uid="lnk45" id="link_product_repo_database"><path d="M1491.26,1148.83 C1438.47,1185.12 1369.0622,1232.8376 1314.4322,1270.3976" fill="none" id="product_repo-to-database" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="1307.84,1274.93,1316.1319,1272.8697,1312.7326,1267.9255,1307.84,1274.93" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="48.9668" x="1404.3198" y="1224.1316">Persists</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="63.1465" x="1397.23" y="1238.2644">[TypeORM]</text></g><!--link emit_ready to rabbitmq_out--><g class="link" data-entity-1="emit_ready" data-entity-2="rabbitmq_out" data-source-line="1773" data-uid="lnk46" id="link_emit_ready_rabbitmq_out"><path d="M1813.09,550.48 C1894.87,560.52 1994.37,584.71 2065.73,641.28 C2121.45,685.45 2149.008,757.9549 2162.738,807.1149" fill="none" id="emit_ready-to-rabbitmq_out" style="stroke:#666666;stroke-width:1;"/><polygon fill="#666666" points="2164.89,814.82,2165.6274,806.3079,2159.8486,807.9219,2164.89,814.82" style="stroke:#666666;stroke-width:1;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="59.4785" x="2187.6701" y="698.3416">Publishes</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38.4727" x="2146.3" y="712.4744">[AMQP</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="3.7969" x="2184.7727" y="712.4744">&#160;</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="99.9492" x="2188.5695" y="712.4744">ClientProxy.emit]</text></g><g class="legend" data-source-line="1569"><rect fill="none" height="16.4883" style="stroke:none;stroke-width:1;" width="167.2891" x="2098.2297" y="1410.23"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.2539" x="2098.2297" y="1423.7652">Legend</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2155.0979" y="1423.7652">&#160;</text><rect fill="#85BBF0" height="16.4883" style="stroke:none;stroke-width:1;" width="167.2891" x="2098.2297" y="1426.7183"/><text fill="#78A8D8" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="8.4287" x="2102.6594" y="1440.2534">&#9647;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2111.0881" y="1440.2534">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.665" x="2119.9475" y="1440.2534">component</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2201.0422" y="1440.2534">&#160;</text><rect fill="#CCCCCC" height="16.4883" style="stroke:none;stroke-width:1;" width="167.2891" x="2098.2297" y="1443.2066"/><text fill="#BFBFBF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="8.4287" x="2102.6594" y="1456.7417">&#9647;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2111.0881" y="1456.7417">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.7119" x="2119.9475" y="1456.7417">external component</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2261.0891" y="1456.7417">&#160;</text><rect fill="none" height="16.4883" style="stroke:none;stroke-width:1;" width="167.2891" x="2098.2297" y="1459.6948"/><text fill="#444444" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="8.4287" x="2102.6594" y="1473.23">&#9647;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2111.0881" y="1473.23">&#160;</text><text fill="#444444" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.4941" x="2119.9475" y="1473.23">container boundary</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="2256.8713" y="1473.23">&#160;</text><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2265.5188" y1="1410.23" y2="1410.23"/><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2265.5188" y1="1426.7183" y2="1426.7183"/><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2265.5188" y1="1443.2066" y2="1443.2066"/><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2265.5188" y1="1459.6948" y2="1459.6948"/><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2265.5188" y1="1476.1831" y2="1476.1831"/><line style="stroke:none;stroke-width:1;" x1="2098.2297" x2="2098.2297" y1="1410.23" y2="1476.1831"/><line style="stroke:none;stroke-width:1;" x1="2265.5188" x2="2265.5188" y1="1410.23" y2="1476.1831"/></g><!--SRC=[fLVTS-8s47_dhzZcfJ03P7gzU-bCRveGBfTEI0YGwwD7s0geiIrEafFGJl_txagoyHS4sYVijNRtf_tyyOD8mpYBEAoDsUXVpiyLUnskX5bdoqnp5ShKyDGCGvcSRsAMcYo91zf4iLYUZpuEfYHwdDoU9qmRhb0KZ6IoaIdfRF1ifpD22qoaN0MNCaiZfhPTnHLBdqMwwiFPB7-6YGYLH9Sl8kJGlUFQ_3xldVNWxmv0ORHh0RsPOCtIAEOABLoB9pDoqfjK6C5YyHUFlhhlPtXW_8AAK1BWQPqbN4ExgZtVXuZ7VCKC7ZCITfzBEeWgGQjdlGh2ZP9H5fOHJfta2pVX-aXaLHMFI2fyqKPPK9fhBMGAeUBCu4CVl6FGHYgsudr0ku29syIS3W0gXXHfYxSQLBB10s-IS5Z1tBrNyDaRLo3Renh10KVmgWIDlmbjD3pH9xh1JJrK0gCQ-8oYgTOW7_Q-Kx48iaramQnG7xnXUCLg1YfcYj2JYBaDp3FVlaeLwHea5aM13wH6-nTHv5EX5_AeUCmn-eWWjm4YBU9XWMYPAInm6n18k668c3NYWXb9y2dOfSzUreiza57nyRqWUJsTbmEF700IP1WbhDA4gUTTwjZkABokUGeH8gkXv0bc3xCVROi-laYZCKefVJFwS1ZNZ1ib4CSkMdtGeGsVMVC4NWI3Yvi-OCuGeeQk_GYVVuLFFLVT1C6riNLd-wI6akuL695mcL6DJV1ruTvy5FLXa1CR5v6oq8WNdWT8KuJ8QWHe2PPCqrCAus_ZkqMmk9cCxnyNmMHU0xFY9k-oSfLTynnCNcmb00yPLzio8lU8rsvesQDzK4LSYtJYdLWS5t6kmR9nBGEQa-0KB1K53sF9Q7YLasi74kBGBitv-I-nVAqXSeqSuAZ3WKM87gt0QyoS-73YScXjclvulnWOHRkw7dL5I0QnlhLCMwUcNro1trdeidah6Y4tC7SdwErHK-QaNE4OkiRoJGLWLT3luCFmq-0fPdezY8NXFLl-J0nqz4mRoDL-WREekCE3hLfzs2T5-Ic-aNvx-YgQeKGB75zR0hhORlZzR09LwUxDZlMIDav_8yosNl1bb_bcRBhEi_E_47WZxK1gll-xmnOlPKTNoouDT4eFkP7Qh1IVFzoIfIl_eUnhWuCDjoHFSIV4R8kbs-lyGwp9sml6RrHfowKmoVT0fALrERFIoOETKXW2tFbmgUIpA_y3t0Q-PpoZQRxVYm_NkrvQUCfxrjqSVX_yRgBliRYoNHIuxY6bSbUHbTlRIGcZxI0YcjHNhIs77Ze_WdFfsHlsVspfbLwBZUxCUDoUZ2OjpQcS7G6JXodyPWrFcS5Tbg8hijLGgp6YyHiFC-EC-9brcL5dDv0K2MlIpwEGDDGQdF2d8UHSpmiRg5eDrHZLXo4WgTfDtEECx654Fm-XGcuibpdEOeMzV1p2s589otLovbCr19IjI91d5lTShUHh9wyMdDDgDowQjLCFQjj4fWrHdJl-2jNQE4crceD3G_c0zxOCd8IYIiLEKYrdQm-9odjb7oyg-CkkADejdGJi21F7HhXynmOZAsxNP5ej5wkhDwdAF6pyJV5ypNCMDoNnVpiMxFtoJnuQRxjXgpw7Qrf4nHQBwRpbbWsMLzpo06bhRU-wfMDYZlrRsktOkldYRcdSbfeehtctn7LfiUVbiRyGZj8_KQKHuThMdMRBMEXrQHUCOa6xGCctxP0KoSZyw_qVmUtuUdntrUtz2m00]--></g></svg>